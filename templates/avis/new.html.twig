{% extends 'base.html.twig' %}

{% block title %}Ajouter un Avis{% endblock %}

{% block body %}
    <h1>Donnez votre avis sur la formation</h1>

    {{ form_start(form) }}
    
    <div>
        {{ form_label(form.note) }}
        {{ form_widget(form.note) }}
        <div>
            {{ form_errors(form.note) }}
        </div>
    </div>

    <div>
        {{ form_label(form.commentaire) }}
        {{ form_widget(form.commentaire) }}
        <div>
            {{ form_errors(form.commentaire) }}
        </div>
    </div>

    <button type="submit">Envoyer</button>
    
    {{ form_end(form) }}
{% endblock %}

{% block javascripts %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
$(document).ready(function() {
    // Handle form submission
    $("#avisForm").submit(function(event) {
        event.preventDefault();  // Prevent the default form submission (page reload)

        // Get the CSRF token and form data
        const csrfToken = $("input[name='_token']").val();
        const formData = $(this).serialize();

        // Send AJAX request to submit the form
        $.ajax({
            type: "POST",
            url: $(this).attr('action'),  // Get the form action URL
            data: formData + "&_token=" + csrfToken,  // Add CSRF token to the data
            success: function(response) {
                // Update the reviews list without reloading the page
                if (response.status === 'success') {
                    // Display success message
                    $("#avisMessage").html("<p style='color: green;'>" + response.message + "</p>");

                    // Update the reviews list with the new review
                    $("#avisList").html(response.html);  // Assuming you return the updated reviews HTML in response
                } else {
                    // Display error message
                    $("#avisMessage").html("<p style='color: red;'>" + response.message + "</p>");
                }
            },
            error: function(xhr, status, error) {
                // Handle any errors
                console.log("Error:", error);
                $("#avisMessage").html("<p style='color: red;'>Erreur lors de l'envoi de l'avis. Veuillez r√©essayer.</p>");
            }
        });
    });
});


    </script>
{% endblock %}
